name: "SERVUS US Onboarding (Okta Master Mode)"
description: "Wait for Okta (from Rippling) -> Customize Downstream"
steps:
  # 1. Validation
  - id: validate
    description: "Validate profile data"
    type: action
    action: builtin.validate_profile

  # 2. WAIT for Identity (Replaces AD Creation)
  # In this mode, Rippling sends user to Okta. We just wait for them to show up.
  - id: wait_for_okta
    description: "Poll Okta: Wait for user to sync from Rippling"
    type: action
    action: okta.find_user

  # 3. Trigger Downstream (If manual push is needed)
  # Sometimes Okta needs a nudge to push to AD/Google immediately
  # (Optional: keep if you want to force immediate syncs)
  # - id: okta_push
  #   description: "Trigger Okta push groups/updates"
  #   type: action
  #   action: okta.trigger_push

  # 4. SaaS Customization (Google)
  - id: google_wait_and_customize
    description: "Google: Wait for SCIM & Move OU"
    type: action
    action: google_gam.wait_for_user_and_customize  # <--- We need to combine logic here or keep separate steps

  # 5. Google Customization (Separate Step)
  - id: google_customize
    description: "Google: Apply Groups & Aliases"
    type: action
    action: google_gam.move_user_ou

  # 6. Device Check (Apple)
  - id: check_device
    description: "Apple: Check device assignment in ABM"
    type: action
    action: apple.check_device_assignment

  # 7. Physical Access (Brivo)
  - id: physical_access
    description: "Brivo: Create badge profile"
    type: action
    action: brivo.provision_access
